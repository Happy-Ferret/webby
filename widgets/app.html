<html>
<head>
  <meta charset="UTF-8">
  <!-- Material Design fonts -->
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css">
  <!-- Bootstrap Material Design -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.7/css/bootstrap-material-design.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.7/css/ripples.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.7/js/material.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.7/js/ripples.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.3.1/localforage.min.js"></script>
  <script src="../js/default_verbs.js"></script>
</head>
<body>
<div id="tip" class="alert alert-warning hidden"></div>
<button id="reset" type="button" class="btn btn-warning">Reset to default Verbs</button>
<h2>Currently Support Verbs</h2>
<section id="configs">
</section>
<script>
  var stoerKey = 'verbstore';
  var configs = document.getElementById('configs');
  var reset = document.getElementById('reset');
  var tip = document.getElementById('tip');

  localforage.getItem(stoerKey, function(err, value) {
    if (err) {
      console.error(err);
    } else {
      verbAddons = JSON.parse(value);
      if (verbAddons) {
        verbAddons.forEach(function(verbAddon) {
          // <h3>open</h3>
          // <ul>
          //   <li>| name: orz | url: www.orz.org | embed: true | </li>
          // </ul>
          var header = document.createElement('h3');
          header.textContent = verbAddon.actionVerb;
          var ul = document.createElement('ul');
          configs.appendChild(header);
          configs.appendChild(ul);

          verbAddon.providers.forEach(function(provider) {
            var li = document.createElement('li');
            li.textContent = '| ';
            for (var prop in provider) {
              if(provider.hasOwnProperty(prop)) {
                li.textContent += prop + ': ' + provider[prop] + ' | ';
              }
            }
            ul.appendChild(li);
          });

          // enable user to add new app for open verb
          if (verbAddon.actionVerb === 'open') {
            var link = document.createElement('a');
            link.href='#openform';
            link.id = verbAddon.actionVerb;
            link.textContent = 'Add new app';
            configs.appendChild(link);
            var form = document.createElement('form');
            form.id = 'openform';
            configs.appendChild(form);

            link.addEventListener('click', function() {
              form.innerHTML = '<label for="name">Name</label>' +
                '<input class="form-control" id="name">' +
                '<label for="url">URL</label>' +
                '<input class="form-control" id="url">' +
                '<select id="embed" class="form-control">' +
                '<option value="true" selected>True</option>' +
                '<option value="false">False</option>' +
                '</select>' +
                '<button id="addapp" class="btn btn-primary">Add App</button>';

              form.addapp.addEventListener('click', function() {
                console.log(form.name.value + ' | ' + form.url.value + ' | ' + form.embed.value);
                var isEmbed = (form.embed.value === 'true') ? true : false;
                verbAddon.providers.push({
                  name: form.name.value,
                  url: form.url.value,
                  embed: isEmbed
                });
                localforage.setItem(stoerKey, JSON.stringify(verbAddons))
                .then(function() {
                  alert('App ' + form.name.value + ' added, reload the page to access the new app');
                });
              });
            });
          }
        });
      }
    }
  });

  reset.addEventListener('click', function() {
    localforage.setItem(stoerKey,
      JSON.stringify(defaultVerbStore)).then(function() {
        if (tip.classList.contains('hidden')) {
          tip.classList.remove('hidden');
        }
        tip.textContent = 'please reload the page';
      });
  });
</script>
</body>
</html>
